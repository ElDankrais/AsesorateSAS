<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>AsesorateSAS</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <link rel="stylesheet" type="text/css" href="styles/registro.css">
    </head>
    <body>
        <div class="registro">
            <h1>Crea tu cuenta en AsesorateSAS</h1>
            <form action="" id="form" target="_blank" method="get">
                <input type="text" name="nombre" id="nombre" placeholder="Nombre" required>
                <br>
                <input type="text" name="cedula" id="cedula" placeholder="Cédula" required>
                <br>
                <input type="email" onblur="validarCorreo()" name="email" id="correo" placeholder="Correo" required>
                <p name='cvalidador' style="visibility: hidden;font-size: 15px;color:red">Éste correo ya se encuentra registrado</p>
                <br>
                <input type="password" name="contrasena" id="contraseña" placeholder="Contraseña" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,16}"
                                                                                                  title="La contraseña debe tener de 6 a 16 dígitos y debe contener: letras mayúsculas, minúsculas y almenos un número"
                                                                                                  required>
                <br>
                <input type="password" name="vcontrasena" onblur="validarContrasenas()" id="contraseña" placeholder="Confirmar contraseña"
                                                                                                        pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,16}"
                                                                                                        title="La contraseña debe tener de 6 a 16 dígitos y debe contener: letras mayúsculas, minúsculas y almenos un número"
                                                                                                        required>
                <p name='validador' style="visibility: hidden;font-size: 15px;color:red">Las contraseñas no coinciden</p>
                <br>
                <input type="text" name="telefono" id="teléfono" placeholder="Teléfono" required>
                <br>
            </form>
            <div class="botones">
                <a href="index.html">Cancelar</a>
                <button type="submit" id="confirmar">Confirmar registro</button>
            </div>
            <br>
            <p id='mensaje' style="visibility: hidden;font-size: 15px;color:green">Usuario registrado correctamente.</p>
            <p id='mensaje2' style="visibility: hidden;font-size: 15px;color:red">Ocurrio un error al registrar el usuario.</p>
        </div>
    </body>

    <script>
        $("form").submit(function(event) {
            event.preventDefault();
            var nombre = jQuery("[name=nombre]").val();
            var cedula = jQuery("[name=cedula]").val();
            var email = jQuery("[name=email]").val();
            var contrasena = jQuery("[name=contrasena]").val();
            var telefono= jQuery("[name=telefono]").val();
            var mensaje= document.querySelector("#mensaje")
            var mensaje2= document.querySelector("#mensaje2")


            fetch('https://fathomless-mesa-60059.herokuapp.com/api/registroEstudiante', {
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json, text-plain, */*"
                },
                method: 'post',
                credentials: "same-origin",
                body: JSON.stringify({
                    nombre: nombre,
                    cedula: cedula,
                    correo: email,
                    contrasena: contrasena,
                    telefono : telefono
                })
            })
                .then((data) => data.json())
                .then(res =>{
                    document.getElementById("form").reset();
                    mensaje.style.visibility = 'visible'
                })
                .catch(function(error) {
                    document.getElementById("form").reset();
                    mensaje2.style.visibility = 'visible'
                    console.log(error);
                });
        });


function validarContrasenas(){
    var contrasena = jQuery("[name=contrasena]").val();
    var vcontrasena = jQuery("[name=vcontrasena]").val();
    var validador = jQuery("[name=validador]");
    var btnConfirmar= document.querySelector("#confirmar")


    if (contrasena==vcontrasena){
        validador.css('visibility','hidden')
        btnConfirmar.disabled = false
        return true;
    }else{
        validador.css('visibility','visible')
        btnConfirmar.disabled = true
        return false;
    }

}

function validarCorreo(){
    var email = jQuery("[name=email]").val();
    var validador = jQuery("[name=cvalidador]");
    var btnConfirmar= document.querySelector("#confirmar")
    btnConfirmar.disabled = true

    fetch('https://fathomless-mesa-60059.herokuapp.com/api/verificarCorreo', {
        headers: {
            "Content-Type": "application/json",
            "Accept": "application/json, text-plain, */*"
        },
        method: 'post',
        credentials: "same-origin",
        body: JSON.stringify({
            correo: email
        })
    })
        .then((data) => data.json())
        .then(res =>{
            if (res.message){
                validador.css('visibility','hidden')
                btnConfirmar.disabled = false
                return true;
            }else{
                validador.css('visibility','visible')
                btnConfirmar.disabled = true
                return false;
            }
        })
        .catch(function(error) {
            console.log(error);
        });



}
    </script>
</html>

